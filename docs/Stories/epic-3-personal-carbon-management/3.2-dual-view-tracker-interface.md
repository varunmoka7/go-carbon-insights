---
id: 3.2-dual-view-tracker-interface
title: Dual-View Tracker Interface & Seamless Mode Switching
epic: Epic 3 â€“ Personal Carbon Management
phase: 3.2
status: planned
---

## Background
This story enables seamless switching between public platform exploration and private data management, allowing users to leverage public insights while maintaining data privacy and context.

## User Story
**As a** user managing private carbon data,
**I want** to seamlessly switch between public platform exploration and private data management,
**so that** I can leverage public insights while maintaining data privacy and context.

## Acceptance Criteria

### Frontend Implementation Requirements

1. **View Mode Context System**
   - Global view mode state management
   - Context-aware component rendering
   - Smooth transitions between modes
   - State persistence across sessions

2. **Unified Search Interface**
   - Search across public and private data
   - Privacy-aware result filtering
   - Context indicators for data sources
   - Search history and suggestions

3. **Combined View Analytics**
   - Privacy-respectful data merging
   - Anonymous benchmarking display
   - Comparative analysis tools
   - Insight generation from combined data

4. **Route Structure & Navigation**
   - Clean URL structure for different views
   - Breadcrumb navigation
   - Deep linking support
   - Mobile-optimized navigation

## Technical Implementation Tasks

### New Components to Create

#### View Mode Management
- [ ] `ViewModeProvider.tsx` - Global view mode context
- [ ] `ViewModeRouter.tsx` - Route-based view switching
- [ ] `ViewModeTransition.tsx` - Smooth transition animations

#### Unified Search
- [ ] `UnifiedSearchBar.tsx` - Search across all data sources
- [ ] `SearchResultsList.tsx` - Privacy-aware result display
- [ ] `SearchFilters.tsx` - Context-based filtering
- [ ] `SearchHistory.tsx` - Recent searches and suggestions

#### Combined Analytics
- [ ] `CombinedAnalyticsDashboard.tsx` - Merged public/private insights
- [ ] `AnonymousBenchmarking.tsx` - Privacy-respectful comparisons
- [ ] `ComparativeAnalysis.tsx` - Side-by-side analysis tools
- [ ] `InsightGenerator.tsx` - AI-powered insights from combined data

#### Navigation Enhancements
- [ ] `ViewModeBreadcrumbs.tsx` - Context-aware breadcrumbs
- [ ] `ViewModeNavigation.tsx` - Mode-specific navigation
- [ ] `DeepLinkHandler.tsx` - URL-based view switching

### Custom Hooks
- [ ] `useViewModeContext.ts` - Global view mode state
- [ ] `useUnifiedSearch.ts` - Search across data sources
- [ ] `useCombinedAnalytics.ts` - Merged data analysis
- [ ] `useViewModeNavigation.ts` - Navigation state management
- [ ] `useDeepLinking.ts` - URL-based view switching

## User Journey Implementation (Journey 2)

### Step 1: View Mode Toggle
```typescript
// In ViewModeToggle.tsx
const ViewModeToggle = () => {
  const { viewMode, setViewMode } = useViewModeContext();
  
  return (
    <div className="view-mode-toggle">
      <button 
        className={viewMode === 'private' ? 'active' : ''}
        onClick={() => setViewMode('private')}
      >
        Private Mode
      </button>
      <button 
        className={viewMode === 'combined' ? 'active' : ''}
        onClick={() => setViewMode('combined')}
      >
        Combined View
      </button>
      <button 
        className={viewMode === 'public' ? 'active' : ''}
        onClick={() => setViewMode('public')}
      >
        Public Platform
      </button>
    </div>
  );
};
```

### Step 2: Combined Analytics
```typescript
// In CombinedAnalyticsDashboard.tsx
const CombinedAnalyticsDashboard = () => {
  const { privateData, publicBenchmarks } = useCombinedAnalytics();
  
  return (
    <div className="combined-dashboard">
      <AnonymousBenchmarking 
        privateData={privateData}
        publicBenchmarks={publicBenchmarks}
        privacySettings={privacySettings}
      />
      <ComparativeAnalysis 
        data={mergedData}
        insights={generatedInsights}
      />
    </div>
  );
};
```

### Step 3: Unified Search
```typescript
// In UnifiedSearchBar.tsx
const UnifiedSearchBar = () => {
  const { searchQuery, setSearchQuery } = useUnifiedSearch();
  const { viewMode } = useViewModeContext();
  
  const handleSearch = (query: string) => {
    const results = searchAcrossDataSources(query, viewMode);
    setSearchResults(results);
  };
  
  return (
    <SearchBar
      placeholder={`Search ${viewMode} data...`}
      onSearch={handleSearch}
      suggestions={getSearchSuggestions(viewMode)}
    />
  );
};
```

## Route Structure
```typescript
// App routing configuration
const routes = [
  { path: '/tracker/public', component: PublicTracker },
  { path: '/tracker/private', component: PrivateTracker },
  { path: '/tracker/combined', component: CombinedTracker },
  { path: '/analytics/public', component: PublicAnalytics },
  { path: '/analytics/private', component: PrivateAnalytics },
  { path: '/analytics/combined', component: CombinedAnalytics },
];
```

## Database Schema Extensions

### View Mode State Management
```sql
-- User view mode preferences
CREATE TABLE user_view_preferences (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  default_view_mode TEXT CHECK (default_view_mode IN ('public', 'private', 'combined')),
  last_view_mode TEXT CHECK (last_view_mode IN ('public', 'private', 'combined')),
  search_history JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Search history and suggestions
CREATE TABLE user_search_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  search_query TEXT NOT NULL,
  view_mode TEXT NOT NULL,
  results_count INTEGER,
  search_timestamp TIMESTAMPTZ DEFAULT NOW()
);
```

## Success Metrics
- **View Switching**: Public/private mode transition <2s
- **Search Performance**: Unified search results <1s
- **Data Isolation**: 100% user isolation with zero data leakage
- **User Experience**: Consistent interface across all view modes 